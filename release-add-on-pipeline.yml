image: docker:latest

pipelines:
  custom:
    manual-deploy:
      - step:
          name: Build and Push Docker Image
          services:
            - docker
          caches:
            - docker
          variables:
            - name: IMAGE_VERSION
              default: "latest"
          script:
            - echo "Logging in to Docker Hub"
            - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
            - echo "Building Docker image"
            - docker build -t $DOCKER_USERNAME/my-image:$IMAGE_VERSION .
            - echo "Pushing Docker image to Docker Hub"
            - docker push $DOCKER_USERNAME/my-image:$IMAGE_VERSION
          after-script:
            - echo "Cleanup"
            - docker logout

definitions:
  services:
    docker:
      memory: 1024

# Cần thiết lập biến môi trường trong Bitbucket:
# - DOCKER_USERNAME: Tên tài khoản Docker Hub
# - DOCKER_PASSWORD: Mật khẩu Docker Hub
# - IMAGE_VERSION: Nhập khi chạy pipeline
